<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Warehouse Restructuring Plan</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
            color: #1e293b;
        }
        .tab-btn {
            transition: all 0.3s ease;
        }
        .tab-btn.active {
            color: #2563eb;
            border-color: #2563eb;
            background-color: #eff6ff;
        }
        .content-section {
            display: none;
        }
        .content-section.active {
            display: block;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 350px;
            padding-bottom: 50%; /* Maintenir le ratio pour responsive */
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 320px;
                padding-bottom: 0; /* Désactiver le padding sur desktop si hauteur fixe */
            }
        }
        .technique-card {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .technique-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }
        .raci-table th, .raci-table td {
            transition: background-color 0.2s ease-in-out;
        }
        .raci-table .highlight {
            background-color: #dbeafe;
        }
        .warehouse-diagram-box {
            border: 2px solid #9ca3af;
            background-color: #f9fafb;
            border-radius: 0.5rem;
            padding: 1rem;
            text-align: center;
        }
        .loading-spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border-left-color: #6366f1;
            animation: spin 1s ease infinite;
            display: none;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="antialiased">

    <div class="min-h-screen container mx-auto p-4 sm:p-6 lg:p-8">
        <header class="text-center mb-8 md:mb-12">
            <h1 class="text-3xl md:text-4xl font-bold text-slate-800">Warehouse Restructuring Plan</h1>
            <p class="mt-2 text-lg text-slate-600">An interactive guide to reimagining your warehouse operations.</p>
             <p class="mt-4 text-sm font-medium text-red-600 border border-red-300 bg-red-50 p-3 rounded-lg">
                API Calls are now proxied through a secure backend (e.g., Netlify Function). **You must deploy the <code>gemini-proxy.js</code> file** separately for AI features to work.
            </p>
        </header>

        <nav class="mb-8">
            <div class="flex flex-col sm:flex-row justify-center border-b border-slate-300">
                <button data-target="intro" class="tab-btn active text-slate-600 font-semibold py-3 px-6 border-b-2 border-transparent hover:bg-slate-100">Introduction</button>
                <button data-target="phase1" class="tab-btn text-slate-600 font-semibold py-3 px-6 border-b-2 border-transparent hover:bg-slate-100">Phase 1: As-Is</button>
                <button data-target="phase2" class="tab-btn text-slate-600 font-semibold py-3 px-6 border-b-2 border-transparent hover:bg-slate-100">Phase 2: To-Be</button>
                <button data-target="phase3" class="tab-btn text-slate-600 font-semibold py-3 px-6 border-b-2 border-transparent hover:bg-slate-100">Phase 3: Implementation</button>
            </div>
        </nav>

        <main>
            <section id="intro" class="content-section active p-4 md:p-6 bg-white rounded-lg shadow-sm">
                <h2 class="text-2xl font-bold mb-4 text-slate-700">Project Goal & Introduction</h2>
                <p class="text-slate-600 leading-relaxed">
                    Welcome to the interactive guide for restructuring your inventory and warehouse management teams. The primary objective of this project is to reimagine how processes and roles are distributed to optimize efficiency and accountability across your facilities. This application will walk you through a structured, three-phase business analysis plan. Use the tabs above to navigate between the different phases of the project, from understanding your current state to implementing and monitoring a new, improved system.
                </p>
                <div class="mt-8">
                    <h3 class="text-xl font-semibold mb-4 text-slate-700">Warehouse Overview</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="warehouse-diagram-box">
                            <h4 class="font-bold text-lg">Warehouse 1</h4>
                            <p class="text-slate-500">Raw Materials</p>
                            <div class="mt-4 space-y-2">
                                <span class="inline-block bg-blue-100 text-blue-800 text-sm font-medium mr-2 px-2.5 py-0.5 rounded-full">Kitchen Accessories</span>
                                <span class="inline-block bg-green-100 text-green-800 text-sm font-medium mr-2 px-2.5 py-0.5 rounded-full">MDF Panels</span>
                            </div>
                        </div>
                        <div class="warehouse-diagram-box">
                            <h4 class="font-bold text-lg">Warehouse 2</h4>
                            <p class="text-slate-500">Appliances & Finished Goods</p>
                            <div class="mt-4 space-y-2">
                                <span class="inline-block bg-purple-100 text-purple-800 text-sm font-medium mr-2 px-2.5 py-0.5 rounded-full">Kitchen Appliances</span>
                                <span class="inline-block bg-yellow-100 text-yellow-800 text-sm font-medium mr-2 px-2.5 py-0.5 rounded-full">Final Produced Product</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="phase1" class="content-section p-4 md:p-6 bg-white rounded-lg shadow-sm">
                <h2 class="text-2xl font-bold mb-2 text-slate-700">Phase 1: Current State Analysis (As-Is)</h2>
                <p class="mb-6 text-slate-600">Before designing the future, you must deeply understand the present. This phase focuses on mapping existing processes, identifying pain points, and documenting current roles to establish a clear baseline for improvement.</p>
                <div class="grid md:grid-cols-3 gap-6">
                    <div class="technique-card bg-slate-50 p-6 rounded-lg border border-slate-200">
                        <h3 class="font-bold text-lg mb-2 text-blue-700">Process Mapping</h3>
                        <p class="text-slate-600">Create visual diagrams of your current inbound and outbound workflows. This helps identify who does what, what inputs are needed, and what outputs are produced at each step.</p>
                    </div>
                    <div class="technique-card bg-slate-50 p-6 rounded-lg border border-slate-200">
                        <h3 class="font-bold text-lg mb-2 text-blue-700">Stakeholder Interviews</h3>
                        <p class="text-slate-600">Conduct interviews with key team members (managers, clerks, leads). This provides invaluable qualitative insight into daily tasks, challenges, and potential improvements.</p>
                    </div>
                    <div class="technique-card bg-slate-50 p-6 rounded-lg border border-slate-200">
                        <h3 class="font-bold text-lg mb-2 text-blue-700">Document Analysis</h3>
                        <p class="text-slate-600">Review existing documentation like role descriptions, training manuals, and Standard Operating Procedures (SOPs) to understand the formally defined processes and roles.</p>
                    </div>
                </div>
                <div class="mt-8 p-6 bg-slate-50 rounded-lg border border-slate-200">
                    <h3 class="font-bold text-lg mb-2 text-slate-700">✨ Interview Question Assistant</h3>
                    <p class="text-slate-600 text-sm mb-4">Get a list of sample questions for a specific role to help with your interviews.</p>
                    <textarea id="interview-role-input" class="w-full h-24 p-2 mb-4 rounded-lg border border-slate-300 text-sm" placeholder="e.g., Warehouse Clerk or Inventory Manager"></textarea>
                    <button id="generate-questions-btn" class="flex items-center justify-center w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition-colors">
                        Generate Questions ✨
                        <div id="questions-loading" class="loading-spinner ml-2"></div>
                    </button>
                    <div id="questions-output" class="mt-4 p-4 bg-white rounded-lg border border-slate-200 text-sm whitespace-pre-wrap leading-relaxed"></div>
                </div>
            </section>

            <section id="phase2" class="content-section p-4 md:p-6 bg-white rounded-lg shadow-sm">
                <h2 class="text-2xl font-bold mb-2 text-slate-700">Phase 2: Future State Definition (To-Be)</h2>
                <p class="mb-6 text-slate-600">Using insights from the 'As-Is' analysis, this phase focuses on designing the new, optimized structure. Here you will define clear roles and responsibilities to streamline operations and create a model for the future.</p>
                <div class="grid lg:grid-cols-2 gap-8">
                    <div>
                        <h3 class="text-xl font-semibold mb-4 text-slate-700">Key Modeling Techniques</h3>
                        <div class="space-y-4">
                            <div class="technique-card bg-slate-50 p-4 rounded-lg border border-slate-200">
                                <h4 class="font-bold text-md text-blue-700">Requirements Workshops</h4>
                                <p class="text-slate-600 text-sm">Bring stakeholders together to brainstorm and agree on core functions, required skills, and how to best leverage the two-warehouse setup.</p>
                            </div>
                            <div class="technique-card bg-slate-50 p-4 rounded-lg border border-slate-200">
                                <h4 class="font-bold text-md text-blue-700">Role Definition</h4>
                                <p class="text-slate-600 text-sm">Define new roles needed for future processes. For each, document its purpose, responsibilities, and necessary competencies.</p>
                            </div>
                            <div class="technique-card bg-slate-50 p-4 rounded-lg border border-slate-200">
                                <h4 class="font-bold text-md text-blue-700">Workload Analysis</h4>
                                <p class="text-slate-600 text-sm">Estimate the volume of activities for each new role to ensure work is distributed balancedly. The chart shows a sample analysis.</p>
                            </div>
                        </div>
                         <div class="mt-6">
                            <h3 class="text-xl font-semibold mb-4 text-slate-700">Example: Workload Analysis</h3>
                            <div class="chart-container h-64 md:h-72">
                                <canvas id="workloadChart"></canvas>
                            </div>
                        </div>
                    </div>
                    <div>
                        <h3 class="text-xl font-semibold mb-4 text-slate-700">Interactive RACI Matrix Example</h3>
                        <p class="text-slate-500 mb-4 text-sm">Hover over a task or role to highlight responsibilities. This matrix clarifies who is Responsible, Accountable, Consulted, and Informed for key tasks.</p>
                        <div class="overflow-x-auto">
                            <table class="raci-table w-full text-left border-collapse">
                                <thead>
                                    <tr>
                                        <th class="p-3 font-semibold uppercase bg-slate-100 border border-slate-300">Process / Task</th>
                                        <th class="p-3 font-semibold uppercase bg-slate-100 border border-slate-300">Inbound Specialist</th>
                                        <th class="p-3 font-semibold uppercase bg-slate-100 border border-slate-300">Dispatch Coordinator</th>
                                        <th class="p-3 font-semibold uppercase bg-slate-100 border border-slate-300">Warehouse Manager</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="hover:bg-slate-50">
                                        <td class="p-3 font-semibold border border-slate-200">Goods Receipt (MDF)</td>
                                        <td class="p-3 border border-slate-200">Responsible</td>
                                        <td class="p-3 border border-slate-200">Informed</td>
                                        <td class="p-3 border border-slate-200">Accountable, Consulted</td>
                                    </tr>
                                    <tr class="hover:bg-slate-50">
                                        <td class="p-3 font-semibold border border-slate-200">Inventory Count</td>
                                        <td class="p-3 border border-slate-200">Responsible</td>
                                        <td class="p-3 border border-slate-200">Consulted</td>
                                        <td class="p-3 border border-slate-200">Accountable</td>
                                    </tr>
                                    <tr class="hover:bg-slate-50">
                                        <td class="p-3 font-semibold border border-slate-200">Order Picking (Products)</td>
                                        <td class="p-3 border border-slate-200">Informed</td>
                                        <td class="p-3 border border-slate-200">Responsible</td>
                                        <td class="p-3 border border-slate-200">Accountable, Consulted</td>
                                    </tr>
                                    <tr class="hover:bg-slate-50">
                                        <td class="p-3 border border-slate-200">Quality Control</td>
                                        <td class="p-3 border border-slate-200">Responsible</td>
                                        <td class="p-3 border border-slate-200">Responsible</td>
                                        <td class="p-3 border border-slate-200">Accountable</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="mt-8 p-6 bg-slate-50 rounded-lg border border-slate-200">
                    <h3 class="font-bold text-lg mb-2 text-slate-700">✨ Role Description Assistant</h3>
                    <p class="text-slate-600 text-sm mb-4">Input a new role title and a few key responsibilities to generate a full role description.</p>
                    <textarea id="role-desc-input" class="w-full h-24 p-2 mb-4 rounded-lg border border-slate-300 text-sm" placeholder="e.g., Inbound Logistics Manager, overseeing inventory and staff."></textarea>
                    <button id="generate-role-desc-btn" class="flex items-center justify-center w-full bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg transition-colors">
                        Generate Role Description ✨
                        <div id="role-desc-loading" class="loading-spinner ml-2"></div>
                    </button>
                    <div id="role-desc-output" class="mt-4 p-4 bg-white rounded-lg border border-slate-200 text-sm whitespace-pre-wrap leading-relaxed"></div>
                </div>
            </section>

            <section id="phase3" class="content-section p-4 md:p-6 bg-white rounded-lg shadow-sm">
                <h2 class="text-2xl font-bold mb-2 text-slate-700">Phase 3: Implementation & Monitoring</h2>
                <p class="mb-6 text-slate-600">With the future state defined, this final phase focuses on managing the transition smoothly and establishing metrics to track success. A well-executed plan ensures the new structure is adopted effectively and delivers the desired results.</p>
                <div class="grid lg:grid-cols-2 gap-8 items-start">
                     <div>
                        <h3 class="text-xl font-semibold mb-4 text-slate-700">Implementation Techniques</h3>
                        <div class="space-y-4">
                           <div class="technique-card bg-slate-50 p-6 rounded-lg border border-slate-200">
                                <h3 class="font-bold text-lg mb-2 text-blue-700">Communication Plan</h3>
                                <p class="text-slate-600">Develop a clear strategy to communicate changes to all team members, explaining the rationale, benefits, and timelines to ensure buy-in and reduce uncertainty.</p>
                            </div>
                            <div class="technique-card bg-slate-50 p-6 rounded-lg border border-slate-200">
                                <h3 class="font-bold text-lg mb-2 text-blue-700">Training Plan</h3>
                                <p class="text-slate-600">Create and deliver training sessions to equip team members with the necessary skills and knowledge for their new or revised roles.</p>
                            </div>
                        </div>
                    </div>
                    <div>
                         <h3 class="text-xl font-semibold mb-4 text-slate-700">Performance Metrics Dashboard</h3>
                         <p class="text-slate-500 mb-4 text-sm">Establish Key Performance Indicators (KPIs) to measure the success of the restructuring. This sample dashboard shows critical metrics to monitor.</p>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                            <div class="bg-slate-50 p-4 rounded-lg border border-slate-200 text-center">
                                <h4 class="font-semibold text-slate-700">Inventory Accuracy</h4>
                                <div class="chart-container h-48 sm:h-56">
                                    <canvas id="accuracyChart"></canvas>
                                </div>
                            </div>
                             <div class="bg-slate-50 p-4 rounded-lg border border-slate-200 text-center">
                                <h4 class="font-semibold text-slate-700">Order Cycle Time (Days)</h4>
                                <div class="chart-container h-48 sm:h-56">
                                    <canvas id="cycleTimeChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="mt-8 p-6 bg-slate-50 rounded-lg border border-slate-200">
                    <h3 class="font-bold text-lg mb-2 text-slate-700">✨ Communication Assistant</h3>
                    <p class="text-slate-600 text-sm mb-4">Draft a clear and professional message to announce changes to the team.</p>
                    <textarea id="comm-plan-input" class="w-full h-24 p-2 mb-4 rounded-lg border border-slate-300 text-sm" placeholder="e.g., Explain the new roles and how it improves efficiency. Target audience: All warehouse staff."></textarea>
                    <button id="generate-comm-plan-btn" class="flex items-center justify-center w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded-lg transition-colors">
                        Draft Communication Plan ✨
                        <div id="comm-plan-loading" class="loading-spinner ml-2"></div>
                    </button>
                    <div id="comm-plan-output" class="mt-4 p-4 bg-white rounded-lg border border-slate-200 text-sm whitespace-pre-wrap leading-relaxed"></div>
                </div>
            </section>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const tabs = document.querySelectorAll('.tab-btn');
            const contentSections = document.querySelectorAll('.content-section');

            // ⚠️ ATTENTION : MODIFICATION CRUCIALE ICI ⚠️
            // L'application est sur GitHub Pages (Domaine 1) et la fonction est sur Netlify (Domaine 2).
            // Nous devons utiliser l'URL complète pour éviter les erreurs de connexion.
            // REMPLACEZ <VOTRE-DOMAINE-NETLIFY-ICI>.netlify.app par votre domaine Netlify réel.
            const netlifyDomain = 'https://effortless-kulfi-52a95b.netlify.app'; 
            const PROXY_ENDPOINT = netlifyDomain + '/api/gemini-proxy'; 
            // ----------------------------------------------------

            const interviewRoleInput = document.getElementById('interview-role-input');
            const generateQuestionsBtn = document.getElementById('generate-questions-btn');
            const questionsOutput = document.getElementById('questions-output');
            const questionsLoading = document.getElementById('questions-loading');

            const roleDescInput = document.getElementById('role-desc-input');
            const generateRoleDescBtn = document.getElementById('generate-role-desc-btn');
            const roleDescOutput = document.getElementById('role-desc-output');
            const roleDescLoading = document.getElementById('role-desc-loading');

            const commPlanInput = document.getElementById('comm-plan-input');
            const generateCommPlanBtn = document.getElementById('generate-comm-plan-btn');
            const commPlanOutput = document.getElementById('comm-plan-output');
            const commPlanLoading = document.getElementById('comm-plan-loading');

            const showLoading = (loader) => loader.style.display = 'block';
            const hideLoading = (loader) => loader.style.display = 'none';

            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const target = tab.dataset.target;
                    tabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    contentSections.forEach(section => {
                        if (section.id === target) {
                            section.classList.add('active');
                        } else {
                            section.classList.remove('active');
                        }
                    });
                });
            });

            const raciTable = document.querySelector('.raci-table');
            if(raciTable) {
                const cells = raciTable.querySelectorAll('td, th');
                cells.forEach(cell => {
                    cell.addEventListener('mouseover', () => {
                        const colIndex = cell.cellIndex;
                        const rowIndex = cell.parentElement.rowIndex;
                        const rowCells = raciTable.rows[rowIndex].cells;
                        for(let i=0; i<rowCells.length; i++) {
                            rowCells[i].classList.add('highlight');
                        }
                        for(let i=0; i<raciTable.rows.length; i++) {
                            raciTable.rows[i].cells[colIndex].classList.add('highlight');
                        }
                    });
                     cell.addEventListener('mouseout', () => {
                        cells.forEach(c => c.classList.remove('highlight'));
                    });
                });
            }

            // Chart setup remains the same (removed for brevity, but assumed to be here)
            // ... (Workload Chart, Accuracy Chart, Cycle Time Chart initialization) ...
            
            const chartOptions = {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            padding: 15,
                            font: {
                                size: 12
                            }
                        }
                    }
                },
                scales: {
                     x: {
                        ticks: {
                            font: {
                                size: 10
                            },
                            autoSkip: false,
                            maxRotation: 0,
                            minRotation: 0
                        },
                        grid: {
                            display: false
                        }
                    },
                    y: {
                        beginAtZero: true,
                         grid: {
                            color: '#e2e8f0'
                        },
                        ticks: {
                             font: {
                                size: 10
                            }
                        }
                    }
                }
            };

            const workloadCtx = document.getElementById('workloadChart');
            if (workloadCtx) {
                new Chart(workloadCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Inbound Specialist', 'Dispatch Coordinator', 'Warehouse Manager'],
                        datasets: [{
                            label: 'Estimated Weekly Hours',
                            data: [38, 40, 35],
                            backgroundColor: ['#60a5fa', '#34d399', '#facc15'],
                            borderColor: ['#3b82f6', '#10b981', '#f59e0b'],
                            borderWidth: 1
                        }]
                    },
                    options: chartOptions
                });
            }

            const accuracyCtx = document.getElementById('accuracyChart');
            if (accuracyCtx) {
                new Chart(accuracyCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Accurate', 'Error'],
                        datasets: [{
                            label: 'Inventory Accuracy',
                            data: [98.5, 1.5],
                            backgroundColor: ['#34d399', '#f87171'],
                            hoverOffset: 4
                        }]
                    },
                     options: {
                        responsive: true,
                        maintainAspectRatio: false,
                         plugins: {
                            legend: {
                                display: false
                            },
                             tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return `${context.label}: ${context.raw}%`;
                                    }
                                }
                            }
                        }
                    }
                });
            }

            const cycleTimeCtx = document.getElementById('cycleTimeChart');
            if (cycleTimeCtx) {
                 new Chart(cycleTimeCtx, {
                    type: 'line',
                    data: {
                        labels: ['Q1', 'Q2', 'Q3', 'Q4'],
                        datasets: [{
                            label: 'Order Cycle Time',
                            data: [2.5, 2.2, 1.9, 1.8],
                            fill: false,
                            borderColor: '#3b82f6',
                            tension: 0.1
                        }]
                    },
                    options: {
                         responsive: true,
                        maintainAspectRatio: false,
                         plugins: {
                             legend: {
                                display: false,
                            }
                         },
                         scales: {
                            y: {
                                beginAtZero: false,
                                title: { display: true, text: 'Days' }
                            }
                         }
                    }
                });
            }


            // --- UPDATED API CALL FUNCTION ---
            const callApi = async (userPrompt, outputElement, loadingElement, systemPrompt) => {
                showLoading(loadingElement);
                outputElement.textContent = 'Generating content...';
                let retries = 3;
                while (retries > 0) {
                    try {
                        // The payload now sends the prompts to our secure proxy
                        const payload = { userQuery: userPrompt, systemPrompt };
                        
                        const response = await fetch(PROXY_ENDPOINT, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });

                        // Vérifier si la réponse du proxy est bonne (statut 200)
                        if (!response.ok) {
                             // Si le proxy renvoie une erreur (ex: 401 pour clé invalide), nous la lisons ici
                            const errorData = await response.json();
                            throw new Error(`Proxy error: ${response.status} - ${errorData.details || errorData.error || 'Unknown error'}`);
                        }
                        
                        const result = await response.json();
                        const generatedText = result.text; // Expecting { text: "..." } from the proxy
                        
                        if (generatedText) {
                            outputElement.textContent = generatedText;
                            break;
                        } else {
                             throw new Error('Received empty response from proxy.');
                        }
                    } catch (error) {
                        console.error("API Call Error:", error);
                        retries--;
                        if (retries === 0) {
                           outputElement.textContent = `Failed to generate content. Please ensure your Netlify Domain is correct and your GEMINI_API_KEY is set. Error: ${error.message}`;
                        } else {
                            // Implémentation d'un backoff exponentiel simple pour les tentatives
                            await new Promise(res => setTimeout(res, 1000 * (4 - retries)));
                        }
                    }
                }
                hideLoading(loadingElement);
            };

            // --- Event Listeners (Use the new callApi function) ---

            generateQuestionsBtn.addEventListener('click', () => {
                const role = interviewRoleInput.value.trim();
                if (role) {
                    const systemPrompt = "You are an expert business analyst and human resources consultant. Your task is to generate relevant and insightful interview questions for a warehouse and inventory management restructuring project. Use French language for the output.";
                    const userPrompt = `Generate a list of interview questions for a stakeholder with the role of "${role}". The questions should help understand their current responsibilities, challenges, and ideas for a new organizational structure. Present the questions as a numbered list.`;
                    callApi(userPrompt, questionsOutput, questionsLoading, systemPrompt);
                } else {
                    questionsOutput.textContent = 'Please enter a role (e.g., Inventory Manager) to generate questions.';
                }
            });

            generateRoleDescBtn.addEventListener('click', () => {
                const description = roleDescInput.value.trim();
                if (description) {
                    const systemPrompt = "You are an expert human resources specialist. Your task is to write a detailed job description based on the input provided. Use French language for the output.";
                    const userPrompt = `Based on this input: "${description}", write a complete role description including key responsibilities, qualifications, and reporting structure.`;
                    callApi(userPrompt, roleDescOutput, roleDescLoading, systemPrompt);
                } else {
                    roleDescOutput.textContent = 'Please enter a role title and a few responsibilities to generate a description.';
                }
            });

            generateCommPlanBtn.addEventListener('click', () => {
                const plan = commPlanInput.value.trim();
                if (plan) {
                    const systemPrompt = "You are a corporate communications manager. Draft a professional, clear, and reassuring internal communication memo regarding organizational changes. Use French language for the output.";
                    const userPrompt = `Draft a communication memo based on this plan: "${plan}". The tone should be positive, focusing on the future and the benefits for the staff.`;
                    callApi(userPrompt, commPlanOutput, commPlanLoading, systemPrompt);
                } else {
                    commPlanOutput.textContent = 'Please enter key elements of your communication plan.';
                }
            });
        });
    </script>
</body>
</html>
