<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plan de Restructuration d'Entrepôt Sécurisé</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fc;
            min-height: 100vh;
        }
        .container {
            max-width: 100%;
        }
        .ai-assistant-card {
            background-color: #ffffff;
            border: 1px solid #e0e6ed;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
        }
        .spinner {
            border-top-color: #3b82f6;
            -webkit-animation: spinner 1s linear infinite;
            animation: spinner 1s linear infinite;
        }
        @-webkit-keyframes spinner {
            0% { -webkit-transform: rotate(0deg); }
            100% { -webkit-transform: rotate(360deg); }
        }
        @keyframes spinner {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* Style pour les messages d'erreur et de succès */
        .message-box {
            padding: 1rem;
            margin-top: 1rem;
            border-radius: 0.5rem;
            font-weight: 600;
        }
        .error-box {
            background-color: #fee2e2;
            color: #ef4444;
            border: 1px solid #fca5a5;
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="container mx-auto">
        <header class="text-center mb-8">
            <h1 class="text-4xl font-extrabold text-gray-800">Plan de Restructuration d'Entrepôt</h1>
            <p class="text-gray-500 mt-2">Feuille de route interactive avec Assistants d'IA sécurisés</p>
        </header>

        <!-- Navigation par Onglets -->
        <div class="flex border-b border-gray-200 mb-6">
            <button class="tab-button flex-1 py-3 px-4 text-sm font-medium focus:outline-none transition-all duration-300 border-b-2 border-transparent text-gray-500 hover:text-blue-600 hover:border-blue-300" data-tab="phase1">Phase 1: Analyse & Questionnaires</button>
            <button class="tab-button flex-1 py-3 px-4 text-sm font-medium focus:outline-none transition-all duration-300 border-b-2 border-transparent text-gray-500 hover:text-blue-600 hover:border-blue-300" data-tab="phase2">Phase 2: Rôles & Descriptions</button>
            <button class="tab-button flex-1 py-3 px-4 text-sm font-medium focus:outline-none transition-all duration-300 border-b-2 border-transparent text-gray-500 hover:text-blue-600 hover:border-blue-300" data-tab="phase3">Phase 3: Communication & Changement</button>
        </div>

        <!-- Contenu des Onglets -->
        <div id="content-container">
            <!-- Contenu de la Phase 1 (Affiché par défaut) -->
            <div id="phase1" class="tab-content active">
                <h2 class="text-2xl font-semibold text-gray-700 mb-4">Phase 1: Assistant de Création de Questions d'Entrevue</h2>
                <p class="text-gray-600 mb-6">Utilisez l'IA pour générer des questions d'entrevue ciblées pour les parties prenantes de l'entrepôt.</p>
                <div class="ai-assistant-card p-6 rounded-xl">
                    <div class="mb-4">
                        <label for="role-input" class="block text-sm font-medium text-gray-700 mb-2">Rôle de la partie prenante (ex: "Chef de Quai", "Opérateur de Chariot Élévateur", "Responsable Logistique")</label>
                        <input type="text" id="role-input" value="Responsable Logistique" placeholder="Entrez le rôle" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <button id="generate-questions-btn" class="w-full bg-blue-600 text-white p-3 rounded-lg font-bold hover:bg-blue-700 transition-colors duration-200 flex items-center justify-center" onclick="generateContent('phase1')">
                        <span id="loader-phase1" class="spinner h-5 w-5 border-4 border-white border-r-transparent rounded-full mr-2 hidden"></span>
                        Générer les Questions
                    </button>

                    <div id="result-phase1" class="mt-6 p-4 bg-gray-50 border border-gray-200 rounded-lg whitespace-pre-wrap text-sm text-gray-800 min-h-[100px]">
                        <!-- Résultat de l'IA ici -->
                        Les questions générées par Gemini apparaîtront ici.
                    </div>
                    <div id="message-phase1"></div>
                </div>
            </div>

            <!-- Contenu de la Phase 2 -->
            <div id="phase2" class="tab-content hidden">
                <h2 class="text-2xl font-semibold text-gray-700 mb-4">Phase 2: Générateur de Description de Rôle</h2>
                <p class="text-gray-600 mb-6">Créez rapidement des brouillons de descriptions de rôles pour la nouvelle structure organisationnelle.</p>
                <div class="ai-assistant-card p-6 rounded-xl">
                    <div class="mb-4">
                        <label for="role-desc-input" class="block text-sm font-medium text-gray-700 mb-2">Rôle et responsabilités clés (ex: "Chef d'équipe, gestion des stocks, formation")</label>
                        <textarea id="role-desc-input" rows="3" placeholder="Décrivez le rôle en quelques mots" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">Nouveau poste d'Analyste de Flux, responsable des goulots d'étranglement et de l'optimisation des parcours.</textarea>
                    </div>
                    <button id="generate-description-btn" class="w-full bg-blue-600 text-white p-3 rounded-lg font-bold hover:bg-blue-700 transition-colors duration-200 flex items-center justify-center" onclick="generateContent('phase2')">
                        <span id="loader-phase2" class="spinner h-5 w-5 border-4 border-white border-r-transparent rounded-full mr-2 hidden"></span>
                        Rédiger la Description de Rôle
                    </button>

                    <div id="result-phase2" class="mt-6 p-4 bg-gray-50 border border-gray-200 rounded-lg whitespace-pre-wrap text-sm text-gray-800 min-h-[100px]">
                        <!-- Résultat de l'IA ici -->
                        Le brouillon de description de rôle apparaîtra ici.
                    </div>
                    <div id="message-phase2"></div>
                </div>
            </div>

            <!-- Contenu de la Phase 3 -->
            <div id="phase3" class="tab-content hidden">
                <h2 class="text-2xl font-semibold text-gray-700 mb-4">Phase 3: Assistant de Communication de Changement</h2>
                <p class="text-gray-600 mb-6">Rédigez un message clair et positif sur les changements à venir pour l'équipe de l'entrepôt.</p>
                <div class="ai-assistant-card p-6 rounded-xl">
                    <div class="mb-4">
                        <label for="comm-input" class="block text-sm font-medium text-gray-700 mb-2">Points clés du message (ex: "Nouvelle automatisation, pas de licenciement, formation obligatoire")</label>
                        <textarea id="comm-input" rows="3" placeholder="Entrez les points clés" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">Changement de l'horaire d'équipe pour une meilleure rotation. Accent mis sur les nouvelles technologies et la sécurité.</textarea>
                    </div>
                    <button id="generate-comm-btn" class="w-full bg-blue-600 text-white p-3 rounded-lg font-bold hover:bg-blue-700 transition-colors duration-200 flex items-center justify-center" onclick="generateContent('phase3')">
                        <span id="loader-phase3" class="spinner h-5 w-5 border-4 border-white border-r-transparent rounded-full mr-2 hidden"></span>
                        Rédiger le Message de Communication
                    </button>

                    <div id="result-phase3" class="mt-6 p-4 bg-gray-50 border border-gray-200 rounded-lg whitespace-pre-wrap text-sm text-gray-800 min-h-[100px]">
                        <!-- Résultat de l'IA ici -->
                        Le brouillon de message apparaîtra ici.
                    </div>
                    <div id="message-phase3"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- Configuration de l'API ---
        // Le domaine Netlify doit être défini ici pour que l'appel inter-domaines (GitHub -> Netlify) fonctionne.
        // ÉTAPE CRUCIALE : REMPLACER <VOTRE-DOMAINE-NETLIFY-ICI> par l'URL complète de votre site Netlify,
        // PAR EXEMPLE : 'https://effortless-kulfi-52a95b.netlify.app'
        const netlifyDomain = 'https://effortless-kulfi-52a95b.netlify.app'; 
        const proxyUrl = netlifyDomain + '/.netlify/functions/gemini-proxy';

        // --- Fonctions de l'Interface Utilisateur ---

        // Gérer le changement d'onglet
        document.querySelectorAll('.tab-button').forEach(button => {
            button.addEventListener('click', () => {
                const tab = button.getAttribute('data-tab');
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.add('hidden');
                    content.classList.remove('active');
                });
                document.getElementById(tab).classList.remove('hidden');
                document.getElementById(tab).classList.add('active');

                document.querySelectorAll('.tab-button').forEach(btn => {
                    btn.classList.remove('border-blue-600', 'text-blue-600');
                    btn.classList.add('border-transparent', 'text-gray-500');
                });
                button.classList.add('border-blue-600', 'text-blue-600');
            });
        });

        // Activer le premier onglet par défaut
        document.querySelector('.tab-button[data-tab="phase1"]').click();


        // Affiche un message (erreur ou succès)
        function showMessage(phase, type, text) {
            const messageBox = document.getElementById(`message-${phase}`);
            messageBox.innerHTML = ''; // Nettoyer les anciens messages
            
            const div = document.createElement('div');
            div.className = `message-box ${type === 'error' ? 'error-box' : 'success-box'} ${type === 'error' ? 'bg-red-100 text-red-700 border-red-400' : 'bg-green-100 text-green-700 border-green-400'}`;
            div.textContent = text;
            messageBox.appendChild(div);

            // Cacher le message après 5 secondes
            setTimeout(() => {
                messageBox.innerHTML = '';
            }, 5000);
        }

        // Gère l'état de chargement
        function setLoading(phase, isLoading) {
            const loader = document.getElementById(`loader-${phase}`);
            const button = document.querySelector(`#${phase} button`);
            
            if (isLoading) {
                loader.classList.remove('hidden');
                button.disabled = true;
                button.classList.add('opacity-50');
            } else {
                loader.classList.add('hidden');
                button.disabled = false;
                button.classList.remove('opacity-50');
            }
        }

        // --- Fonction Principale d'Appel à l'IA ---

        async function generateContent(phase) {
            const resultDiv = document.getElementById(`result-${phase}`);
            const messageDiv = document.getElementById(`message-${phase}`);
            let userQuery = '';
            let systemPrompt = '';

            // Définir les prompts pour chaque phase
            switch (phase) {
                case 'phase1': // Questions d'Entrevue
                    const role = document.getElementById('role-input').value;
                    if (!role) {
                        showMessage(phase, 'error', "Veuillez entrer un rôle.");
                        return;
                    }
                    systemPrompt = "Agis comme un consultant en logistique expérimenté. Génère 5 questions d'entrevue ouvertes et perspicaces axées sur les défis de la restructuration pour le rôle donné.";
                    userQuery = `Générer 5 questions pour le rôle : ${role}`;
                    break;

                case 'phase2': // Description de Rôle
                    const descInput = document.getElementById('role-desc-input').value;
                    if (!descInput) {
                        showMessage(phase, 'error', "Veuillez entrer une description de rôle.");
                        return;
                    }
                    systemPrompt = "Agis comme un spécialiste RH. Rédige une description de poste professionnelle et structurée de 150 mots maximum basée sur les points clés suivants. Incluez le titre, le résumé, et 3 responsabilités clés.";
                    userQuery = `Rédiger une description de poste pour : ${descInput}`;
                    break;

                case 'phase3': // Communication de Changement
                    const commInput = document.getElementById('comm-input').value;
                    if (!commInput) {
                        showMessage(phase, 'error', "Veuillez entrer les points clés de la communication.");
                        return;
                    }
                    systemPrompt = "Agis comme un directeur de communication. Rédige un message d'entreprise clair, transparent et motivant d'environ 100 mots maximum à l'équipe sur les changements de restructuration basés sur ces points. Le ton doit être positif et mettre en avant les opportunités.";
                    userQuery = `Rédiger un message de communication sur : ${commInput}`;
                    break;

                default:
                    return;
            }

            setLoading(phase, true);
            resultDiv.textContent = "Génération en cours... Veuillez patienter.";
            messageDiv.innerHTML = '';

            try {
                const response = await fetch(proxyUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ userQuery, systemPrompt }),
                });

                if (!response.ok) {
                    // Si le statut HTTP n'est pas 200, l'erreur vient du serveur (Netlify)
                    const errorText = await response.text();
                    console.error("Erreur du Proxy Netlify:", errorText);
                    resultDiv.textContent = "Échec de la génération de contenu. Vérifiez la console pour les erreurs de déploiement du proxy Netlify.";
                    showMessage(phase, 'error', "Erreur de connexion : Proxy Netlify injoignable ou en échec.");
                    return;
                }

                const result = await response.json();
                
                if (result.error) {
                    console.error("Erreur de l'API Gemini:", result.error);
                    resultDiv.textContent = `Erreur de l'API : ${result.error}. (Vérifiez votre clé GEMINI_API_KEY sur Netlify)`;
                    showMessage(phase, 'error', "Erreur API : Vérifiez la clé sur Netlify et le journal des fonctions.");
                } else {
                    resultDiv.textContent = result.text;
                    showMessage(phase, 'success', "Contenu généré avec succès !");
                }

            } catch (error) {
                console.error("Erreur réseau ou CORS:", error);
                resultDiv.textContent = "Erreur de connexion réseau ou d'URL. Vérifiez si l'URL Netlify est correcte dans le code source.";
                showMessage(phase, 'error', "Échec de l'envoi de la requête au proxy. URL incorrecte ou erreur CORS.");
            } finally {
                setLoading(phase, false);
            }
        }
    </script>
</body>
</html>

